#!/bin/bash
set -e  # Skript bricht bei Fehlern ab

# Variablen
PACKAGES_FILE="./packages.txt"
REPO_DIR="$HOME/dotfiles"
CONFIG_DIR="$HOME/.config"

# Pakete installieren
if [[ ! -f "$PACKAGES_FILE" ]]; then
    echo "Datei $PACKAGES_FILE nicht gefunden!"
    exit 1
fi

sudo pacman -S --needed - < "$PACKAGES_FILE"

# Repo klonen
if [[ ! -d "$REPO_DIR" ]]; then
    git clone https://github.com/orkansama/dotfiles.git "$REPO_DIR"
fi

# Zielordner in .config erstellen
mkdir -p "$CONFIG_DIR"

# Hyprland und Waybar inkl. .git kopieren
cp -r "$REPO_DIR/hypr" "$CONFIG_DIR/"
cp -r "$REPO_DIR/waybar" "$CONFIG_DIR/"

# .git und .gitignore kopieren
cp -r "$REPO_DIR/.git" "$CONFIG_DIR/"
cp "$REPO_DIR/.gitignore" "$CONFIG_DIR/"

# Wenn alles erfolgreich war, Repo löschen
rm -rf "$REPO_DIR"

echo "Installation abgeschlossen, dotfiles kopiert und Repo gelöscht!"
